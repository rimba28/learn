{% extends "../../app/layout.html" %}
{% block SearchData %}
{% for itemCombo in populateColumn %}
<li><a href="#" data-tipe="{{itemCombo.dataType}}" data-column="{{itemCombo.columnName}}">{{itemCombo.label}}</a></li>
{% endfor %}
{% endblock %}

{% block javascriptAndUI %}
<!--================================Load Script Modules NA ===========================================-->
<script type="text/javascript" src="../../../static/app/scripts/NAJS.js"></script>
<!--=======================================================================================================-->

<script type="text/javascript">
    
	(function(){ 

	    if (!NA.common.getElementID('CustomSearch')) {
	        var parentC = NA.common.doc.querySelector('ul.dropdown-menu.search');
	        lastLi = NA.common.doc.createElement('li'),
			lastLi_a = NA.common.doc.createElement('a');
	        lastLi_a.setAttribute('id', 'custSearch');
	        lastLi_a.textContent = 'CustomSearch';
	        lastLi.appendChild(lastLi_a);
	        parentC.appendChild(lastLi);
	    }
//=================add Dynamic Styles=============================
        NA.common.loadStyles("../../../static/app/content/jquery-ui.min.css","jqueryUI");
        NA.common.loadStyles("../../../static/app/content/ui.jqgrid.css","UIJqueryGrid");   
        var doc = doc||window.document;
        var DivSearch = doc.querySelector('ul.dropdown-menu.search');//return list Element
        (function(elm){
            var listElem = elm.children;
            Array.prototype.forEach.call(listElem,function(item){//buat jadi foreach mesti convert dulu ke array
                NA.NAEvent.addHandler(item, 'click', function (event) {
                    event.preventDefault();
                    if (item.firstChild.id === 'custSearch') {
                        //=========='show dialog search'==================
                        //NA.common.dialog.createSearchDialog(event)
                    }
                    NA.common.getElementID('bySearch').firstChild.nodeValue = item.textContent;
                });
            });
        })(DivSearch);
    })();   
</script>

{% load static %}
<script src="{% static 'app/scripts/jquery-1.11.0.min.js' %}" id="jq_uery"></script>
<script type="text/javascript" src="{% static 'app/scripts/grid.locale-en.js' %}"></script>

<script src="{% static 'app/scripts/jquery.jqGrid.min.js' %}"></script>
<script src="{% static 'app/scripts/jquery-ui.js' %}"></script>
<script type="text/javascript">if (typeof $.fn.modal == 'undefined') { NA.common.doc.write('\<script src\=\"\.\.\/\.\.\/\.\.\/static\/app\/scripts\/bootstrap\.js\"\>\<\/script\>'); }</script>
<script src="../../../static/app/scripts/bootstrap-dialog.js"></script>
{% endblock %}

{%block content-0 %}
<table id="jqGrid_NA_F_Goods_Receive"></table>
<div id="jqGrid_NA_F_Goods_Receive_Pager"></div>

{%endblock%}

{% block DialogEntry %}
<script type="text/javascript">
	//=================================AJAX Setup===========================-->

	(function () {
		$.ajaxSetup({
			cache: false,
			error: function (xhr, status, error) {
				try {
					var messageErr = xhr.responseText;
					var contentype = xhr.getResponseHeader('Content-Type')
					if (contentype === 'application/json') {
						messageErr = $.parseJSON(xhr.responseText);
					}
					var message = xhr.responseText;
					if (messageErr) {
						message = messageErr.message;
					}
					if (message) {
						alert('An error occurred: ' + error + '\n' + xhr.status + ": " + message);
					}

				} catch (e) {
					alert('An error occurred: ' + error + '\n' + xhr.status + ": " + e.message);
				}
				window.document.body.style.cursor = 'defautl'; return false;
			},
			timeout: 2000000, // Timeout// nanti kalau sudah selesai system timeout ini harus di rubah, jadi maximal 20 detik
			type: 'GET',
			crossDomain: false, // obviates need for sameOrigin test                              
		});

		//===================================END AJAX SetuP===========================--> 

		//========================Variable Object untuk ===============================
		var win = win || window,
        grid = $("#jqGrid_NA_F_Goods_Receive"),
        txtSearchMaster = txtSearchMaster || NA.common.doc.querySelector('form.navbar-form div.input-group input[name="q"]'),
        btnSearchMaster = btnSearchMaster || NA.common.doc.querySelector('form.navbar-form button[type="submit"].btn.btn-default'),
        status = status || win.status, csrftoken = function () { return NA.CookieUtil.get('csrftoken'); }, initializeForm = '',
        //settings btn sesuai user access
        //anggap saja sekarang admin
        btnSave = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(4)'),
        btnDelete = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(5)'),
        btnExport = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(6)'),
        btnPrint = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(7)'),
        btnHelp = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(8)'),
        containerMenu = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav');//inistialisasi menu 

		window.onunload = function () {
			if (typeof txtSearchMaster.onclick == "function") {
				NA.NAEvent.removeHandler(txtSearchMaster, 'keydown', handlerSearchInput)
			}
			if (typeof btnSearchMaster.onclick == "function") {
				NA.NAEvent.removeHandler(btnSearchMaster, 'click', handlerSearchInput);
			}
		};
		function LoadData(page) {
			var url = 'NA_Goods_Receive_Search/?' + win.encodeURIComponent('columnName') + '=' + win.encodeURIComponent(NA.common.SearchData.getColumnKey()) +
                      '&' + win.encodeURIComponent('valueKey') + '=' + win.encodeURIComponent(NA.common.SearchData.getValueKey()) +
                      '&' + win.encodeURIComponent('dataType') + '=' + win.encodeURIComponent(NA.common.SearchData.getDataType()) +
                      '&' + win.encodeURIComponent('criteria') + '=' + win.encodeURIComponent(NA.common.SearchData.getCriteria());
			if (arguments.length > 0) {
				grid.setGridParam({ url: url }).trigger("reloadGrid", [{ page: page, }]);
			}
			else {
				try {
					grid.jqGrid({
						url: url,
						mtype: "GET",
						datatype: "json",//#column IDapp  no	goods 	datereceived supliername FK_ReceivedBy 	receivedby FK_P_R_By pr_by totalpurchase totalreceived,CreatedDate, CreatedBy 
						colNames: ['idapp', 'NO', 'Goods Name', 'Date Received', 'Suplier Name', 'FK_ReceivedBy', 'Received By', 'FK_P_R_By ', 'Purchase Request By', 'Total Purchased', 'Total Received','Descriptions', 'Created Date', 'Created By'],
						colModel: [
                            { name: 'idapp', key: true, hidden: true, align: 'left' },
                            { name: 'NO', width: 40, align: 'right', sortable: false, editable: false, },
                            { name: 'goods', index: 'goods', width: 120, sortable: true, editable: false, align: 'left', },
                            { name: 'datereceived', index: 'datereceived', sortable: true, width: 120, formatter: 'date', formatoptions: { srcformat: 'Y-m-d', newformat: 'd F Y' } },
                            { name: 'supliername', index: 'supliername', width: 150, sortable: true, editable: false, align: 'left', },
                            //formatter : 'date', formatoptions: { srcformat : 'Y-m-d H:i:s', newformat :'ShortDate'}},
                            { name: 'FK_ReceivedBy', index: 'FK_ReceivedBy', hidden: true, },
                            { name: 'receivedby', index: 'receivedby', width: 120, sortable: true, editable: false, align: 'left', },
                            { name: 'FK_P_R_By', index: 'FK_ReceivedBy', hidden: true, },
                            { name: 'pr_by', index: 'pr_by', width: 120, sortable: true, editable: false, align: 'left', },
                            {
                            	name: 'totalpurchase', index: 'totalpurchase', width: 100, sortable: true, align: 'right',                             	
                            },
                            {
                            	name: 'totalreceived', index: 'totalreceived', width: 100, sortable: true, align: 'right',
                            },
							{ name: 'descriptions', index: 'descriptions', width: 280, sortable: true, editable: false, align: 'left', },
                            { name: 'createddate', index: 'CreatedDate', sortable: true, width: 120, formatter: 'date', formatoptions: { srcformat: 'Y-m-d', newformat: 'd F Y' } },
                            { name: 'reatedby', index: 'CreatedBy', sortable: true, width: 110, editable: false, },
						],
						ondblClickRow: function (rowId) {
							var btnOpen = NA.common.doc.querySelector('ul.nav.navbar-nav>li:nth-child(2)>button');
							if (btnOpen) {
								btnOpen.click();
							}
						},
						gridComplete: function () {
							document.body.style.cursor = 'default';
						},
						cellEdit: false,
						viewrecords: true,
						height: $('div.fltlft').height() - ($('div.fltlft').height() * 0.173),
						rowNum: 300,
						rowList: [20, 50, 100, 200, 300, 500],
						sortname: "idapp",
						sortorder: "desc",
						multiSort: true,
						shrinkToFit: false,
						iconSet: "fontAwesome",
						forceFit: true,
						toolbar: true,
						scrollrows: true,
						hidegrid: true,
						caption: "Transactions ---Goods Received",
						pager: "#jqGrid_NA_F_Goods_Receive_Pager"
					});
					grid.navGrid("#jqGrid_NA_F_Goods_Receive_Pager", {
						search: false, // show search button on the toolbar
						add: false,
						edit: false,
						del: false,
						refresh: true
					});

				} catch (e) {
					alert(e.message);
					console.log(e);
					document.body.style.cursor = 'default';
				};
			};
		};

		var SearchData = NA.common.SearchData;
		SearchData.setDefaultSearchData('goods', 'varchar', 'like');
		LoadData();

		NA.common.doc.title = 'Entry Data Goods Receive';
		//disablekan save dan help karena saat ini tidak di pakai
		btnSave.setAttribute('disable', true);
		btnHelp.setAttribute('disable', true);
		NA.common.loadStyles("../../../static/app/content/Dialog.css", "DialogEntryStyle");//Load Style buat dialog sebelum di pakai
		NA.common.loadStyles("../../../static/app/content/NA_commonEntry.css", "CommonEntry");//Load Style buat form sebelum di pakai
		NA.common.dialog.initDialog(containerMenu, 'Nufarm Entry Goods Receive - Transactions');//inistialisasi menu     

		//====================GROUP FUNCTION DECLARATION===============================

		function getValuesForm() {
			//idapp,fk_goods, idapp_fk_goods,goods_desc,datereceived, fk_suplier,supliername, totalpurchase, totalreceived, idapp_fk_received, fk_receivedby,employee_received,idapp_fk_p_r_by, fk_p_r_by,employee_pr, descriptions	
			var elfk_goods = NA.common.getElementID('id_fk_goods'),
				fk_goods = elfk_goods.dataset.value;
			var elgoods_desc = NA.common.getElementID('id_goods_desc'),
				goods_desc = elgoods_desc.value;
			var eldatereceived = NA.common.getElementID('id_datereceived'),
				datereceived = eldatereceived.value.toString().trim();
			var elfk_suplier = NA.common.getElementID('id_fk_suplier'),
				fk_suplier = elfk_suplier.value;
			var elsupliername = NA.common.getElementID('id_supliername'),
				supliername = elsupliername.value;
			var eltotalpurchase = NA.common.getElementID('id_totalpurchase'),
				totalpurchase = eltotalpurchase.value;
			var eltotalreceived = NA.common.getElementID('id_totalreceived'),
				totalreceived = eltotalreceived.value;
			var elfk_p_r_by = NA.common.getElementID('id_fk_p_r_by'),
				fk_p_r_by = elfk_p_r_by.dataset.value;
			var elemployee_pr = NA.common.getElementID('id_employee_pr'),
				employee_pr = elemployee_pr.value;
			var elfk_receivedby =  NA.common.getElementID('id_fk_receivedby'),
				fk_receivedby = elfk_receivedby.dataset.value;
			var elemployee_received = NA.common.getElementID('id_employee_received'),
				employee_received = elemployee_received.value;
			var eldescriptions = NA.common.getElementID('id_descriptions'),
				descriptions = eldescriptions.value;
			var status = window.status || NA.common.getElementID('id_status').value;
			var serialNum = NA.common.getElementID('id_serialNum').value.substr(1);
            var len_serial = serialNum.split(',').length
			return {
                idapp:grid.jqGrid('getGridParam','selrow'),
				fk_goods: fk_goods,
				goods_desc:goods_desc,
				datereceived: datereceived,
				fk_suplier: fk_suplier,
				supliername:supliername,
				totalpurchase: totalpurchase,
				totalreceived: totalreceived,
				fk_p_r_by: fk_p_r_by,
				employee_pr:employee_pr,
				fk_receivedby: fk_receivedby,
				employee_received:employee_received,
				descriptions: descriptions,
				status: status,
				serialNum: serialNum,
                len_serial:len_serial
			};
		};
		function getGridCellValue(thegrid,CeltoGet) {
			var reccount = thegrid.jqGrid('getGridParam', 'reccount');
			var rowId, rowData, colData;
			if (reccount > 0) {
				rowId = thegrid.jqGrid('getGridParam', 'selrow');
				if (rowId) {
					rowData = thegrid.getRowData(rowId);
					colData = rowData[CeltoGet];
				}
			}
			return colData;
		};
		//csrf token untuk form
		function csrfSafeMethod(method) {
			// these HTTP methods do not require CSRF protection
			return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
		};
		function XhrError(xhr) {
			try {
				var messageErr = xhr.responseText;
				var contentype = xhr.getResponseHeader('Content-Type')
				if (contentype === 'application/json') {
					messageErr = JSON.parse(xhr.responseText);
				}
				var message = xhr.responseText;
				if (messageErr) {
					message = messageErr.message;
				}
				if (message) {
					alert('An error occurred: ' + message);
				}
				document.body.style.cursor = 'default';
			} catch (e) {
				alert('An error occurred: ' + e + '\n' + e.message);
				document.body.style.cursor = 'default';
			}
			return false;
		};
		function ExecuteHandler(TextElement) {
			try {
				var dialog = NA.common.dialog.doc.querySelector("div.containerDialog");
				var frmEntry = NA.common.getElementID('frm-NA-Entry-Goods_Receive');
				switch (TextElement) {
					case 'OK': {
						if (!frmEntry.checkValidity()) {
							//NA.NAEvent.preventDefault(event);                                          
							var inputbtn = NA.common.getElementID('inputButton');
							inputbtn.click();
						}
						else {
							//check existing
							var elfk_goods = NA.common.getElementID('id_fk_goods'),
								fk_goods = elfk_goods.value;
							var eldatereceived = NA.common.getElementID('id_datereceived'),
								datereceived = eldatereceived.value.toString().trim();
							var eltotalpurchase = NA.common.getElementID('id_totalpurchase'),
								totalPurchase = eltotalpurchase.value;
							$.ajax({
								url:'HasExists/',
								data:{
									'fk_goods': fk_goods,
									'datereceived': datereceived,
									'totalpurchase': totalPurchase
								},
								success: function(data){
									console.log(data['message'])
									if (data['message'] == 'False') {
										submitForm();
									}
								}
							});
						}
						break;
					}
					case 'Cancel':
					case 'Close': {
						//check if data has changed with javascrispt
						initializeForm = NA.common.getElementID('id_initializeForm');
						if (status === 'Open' || initializeForm.Value == '') { NA.common.dialog.closeDialog(dialog); return false; }
						var originalData = JSON.parse(initializeForm.Value);
						var valuesForm = getValuesForm();
						if (NA.common.detectInputChanges(originalData, valuesForm)) {
						    BootstrapDialog.confirm({
						        size: BootstrapDialog.SIZE_SMALL,
								title: NA.common.message.titleInfo,
								message: NA.common.message.dataHasChanged,
								type: BootstrapDialog.TYPE_WARNING, // <-- Default value is BootstrapDialog.TYPE_PRIMARY
								animate: false,
								closable: false, // <-- Default value is false
								draggable: true, // <-- Default value is false
								btnCancelLabel: 'NO.', // <-- Default value is 'Cancel',
								btnOKLabel: 'Yes.', // <-- Default value is 'OK',
								btnOKClass: 'btn-success', // <-- If you didn't specify it, dialog type will be used,
								callback: function (result) {
									// result will be true if button was click, while it will be false if users close the dialog directly.
									if (result) {
										if (!frmEntry.checkValidity()) {
											var inputbtn = NA.common.getElementID('inputButton');
											inputbtn.click();
										}
										else {
											if (submitForm()) {
												NA.common.dialog.closeDialog(dialog);
											}
										}
									}
									else {
										NA.common.dialog.closeDialog(dialog);
									}
								}
							});											
						}
						else {
							NA.common.dialog.closeDialog(dialog);
						}						
						document.body.style.cursor = 'default';
						break;
					}
				};
			} catch (e) {
			    alert(e);
			}
			document.body.style.cursor = 'default';
			return true;
		};
		function formatDate(date) {
		    var d = new Date(date),
                month = '' + (d.getMonth() + 1),
                day = '' + d.getDate(),
                year = d.getFullYear();

		    if (month.length < 2) month = '0' + month;
		    if (day.length < 2) day = '0' + day;

		    return [year, month, day].join('-');
		}
		function submitForm() {
			//var valuesForm = JSON.stringify(getValuesForm());
			var valuesForm = getValuesForm();
			//valuesForm['status'] = status || $('input[name="status"]').val();
			valuesForm['csrfmiddlewaretoken'] = (function () {
				var el = document.getElementsByName("csrfmiddlewaretoken");
				return el[0].getAttribute("value");
			})();
			var FDate = $('#id_datereceived').val(); FDate = $.datepicker.parseDate('dd/mm/yy', FDate);
			CDate = formatDate(FDate);

			valuesForm['datereceived'] = CDate;
			var dialog = NA.common.dialog.doc.querySelector("div.containerDialog");
			$.ajax({
				url:'ShowEntry_Receive/',
				method: 'POST',
				data:valuesForm,
				success: function(data){
					NA.common.dialog.closeDialog(dialog);
					grid.trigger('reloadGrid');
				}
			})
		};

		//atur tampilan form searching entry
		function restyleBoostrapDialog() {
			var BSDialogContent = NA.common.doc.querySelector('div.modal-dialog.modal-sm >.modal-content');
			BSDialogContent.style.cssText = 'width: 440px; height: 340px;';
			var ContentBody = NA.common.doc.querySelector('div.modal-dialog.modal-sm >.modal-content>.modal-body');
			ContentBody.style.cssText = 'padding:0px;';
			var contentFooter = NA.common.doc.querySelector('div.modal-dialog.modal-sm >.modal-content>.modal-footer');
			contentFooter.style.cssText = 'padding-bottom:0px;padding-top:0px;margin:5px';
			var mHeader = NA.common.doc.querySelector('div.bootstrap-dialog .modal-header.bootstrap-dialog-draggable');
			mHeader.style.cssText = 'height:30px;padding:0px;';
			var footerButton = NA.common.doc.querySelector('div.bootstrap-dialog-footer-buttons');
			footerButton.style.cssText = 'padding-top:8px;';
		};
		//========================END GROUP FUNCTION DECLARATION===================================
        
		//=======================GROUP FUNCTION EVENT=============================================
		//set eventKeyboard di search textbox
		function handlerSearchInput(event) {
			event = NA.NAEvent.getEvent(event);
			if (event.keyCode === 13 || event.target == btnSearchMaster) {
				NA.NAEvent.preventDefault(event);
				var elSearch = NA.common.doc.querySelector('li.dropdown>a#bySearch'),
                SearchBy = NA.common.doc.querySelector('li.dropdown>a#bySearch').textContent.trim();
				if (SearchBy.trim() == 'By') {
					SearchData.setDefaultSearchData('goods', 'varchar', 'like');
					var curPage = parseInt(grid.getGridParam('page'));
					window.document.body.style.cursor = 'wait';
					if (event.target.value !== '') {
						NA.common.SearchData.setValue(event.target.value);
					}
					LoadData(curPage);
				}
				else {
					//submit search
					submitSearch(event);
				}
				NA.NAEvent.stopPropagation(event);
			}
			window.document.body.style.cursor = '';
		};
		function submitSearch(event) {
			window.document.body.style.cursor = 'wait';
			if (event)
				NA.NAEvent.preventDefault(event);

			var elementOption = null, columnKey = '', valueKey = '',
            elCriteria = null,//NA.common.doc.querySelector('td.columns select.selectopts.NA-Form-Control option:checked');
            valCriteria = '',//elCriteria.nodeValue;
            elDataType = '';//elementOption.dataset.dataType;
			//get  ajax with querystring search
			//valueKey : valueKey,
			//columnKey :columnKey,
			//dataType : dataType,
			//criteria : criteria,
			if (event.target.getAttribute('id') === 'fbox_jqGrid_search' || event.target.getAttribute('id') === 'jqg1') {//fbox_jqGrid_search == button search,jqg1 = txtSearch nya
				elementOption = NA.common.doc.querySelector('td.columns select.NA-Form-Control option:checked');
				columnKey = elementOption.getAttribute('name'), valueKey = NA.common.getElementID('jqg1').value;
				elCriteria = NA.common.doc.querySelector('td.operators select.selectopts.NA-Form-Control option:checked');
				criteria = elCriteria.value;
				switch (valCriteria) {
					case "eq": { criteria = 'equal'; break; }
					case "ne": { criteria = 'not equal'; break; }
					case "bw": { criteria = 'beginwith'; break; }
					case "ew": { criteria = "endwith"; break; }
					case "cn": { criteria = "contains"; break; }
					case "in": { criteria = "in"; break; }
					case "ni": { criteria = "notin"; break; }
					case "gt": { criteria = "Greater"; break; }
					case "le": { criteria = "less"; break; }
					case "leq": { criteria = "lessorequal"; break; }
					case "gtq": { criteria = "greaterorequal"; break; }
					case "bw": { criteria = "between"; break; }
				};
				elDataType = elementOption.dataset.tipe;
			}
			else if (event.target == txtSearchMaster || event.target == btnSearchMaster) {
				var txtSearchMaster = txtSearchMaster || NA.common.doc.querySelector('form.navbar-form div.input-group input[name="q"]'),
                elSearch = null;
				valueKey = txtSearchMaster.value.trim();
				var listElem = NA.common.doc.querySelector('ul.dropdown-menu.search').children;//return list Element
				var textToSearch = NA.common.getElementID('bySearch').firstChild.nodeValue;
				Array.prototype.forEach.call(listElem, function (item) {//buat jadi foreach mesti convert dulu ke array                   
					if (item.firstChild.textContent === textToSearch) {
						elSearch = item.firstChild;
					}
				});
				columnKey = elSearch.dataset.column
				elDataType = elSearch.dataset.tipe;
				criteria = 'like'
				if (!elSearch.dataset.column) {
					switch (elDataType) {
						case "bigint":
						case "integer":
						case "money":
						case "float":
						case "decimal":
						case "boolean":
						case "datetime": {
							if (valueKey.toString().indexOf(',') > -1) {
								criteria = 'in'
							}
							criteria = 'equal';
							break;
						}
					};
				}
			};

			SearchData.setValue(valueKey);
			SearchData.setColumnName(columnKey);
			SearchData.setDataType(elDataType)
			SearchData.setCriteria(valCriteria);
			window.document.body.style.cursor = 'wait';
			LoadData(1);
			document.body.style.cursor = 'default';
			//grid.setGridParam.trigger("reloadGrid",[{page:1}]);//karena searching harus di set ke page 1
		};

		//function untuk Reset
		function submitReset(event) {
			window.document.body.style.cursor = 'wait';
			SearchData.setDefaultSearchData('goods', 'varchar', 'like');
			SearchData.setValue('');
			LoadData(1);
			window.document.body.style.cursor = 'default';
		};		
		//=======================END GROUP FUNCTION EVENT========================================

		//=======================GROUP ASSINGED HANDLER ========================================= 
		//assign delete key event
		grid.on("keyup", "tr", function (e) {
			//var rowid = parseInt($(this).attr("id"));
			var rowId = grid.jqGrid('getGridParam', 'selrow');
			if (e.keyCode == 46) {
				var btnDelete = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(5)')
				btnDelete.click();
				return false;
			}
		});

		//=======================handler txt & button Search master keyboard event and click================================        
		NA.NAEvent.addHandler(txtSearchMaster, 'keydown', handlerSearchInput);
		NA.NAEvent.addHandler(btnSearchMaster, 'click', handlerSearchInput);
		//=========================================================================================     

		NA.NAEvent.addHandler(btnDelete, 'click', function (event) {
			var idapp = getGridCellValue(grid,'idapp');
			if (idapp) {
				NA.NAEvent.preventDefault(event);
			 	return BootstrapDialog.confirm({
					title: NA.common.mesage.titleInfo,
					message: NA.common.mesage.confirmDelete,
					type: BootstrapDialog.TYPE_WARNING, // <-- Default value is BootstrapDialog.TYPE_PRIMARY
					animate: false,
					closable: false, // <-- Default value is false
					draggable: true, // <-- Default value is false
					btnCancelLabel: 'NO.', // <-- Default value is 'Cancel',
					btnOKLabel: 'Yes.', // <-- Default value is 'OK',
					btnOKClass: 'btn-success', // <-- If you didn't specify it, dialog type will be used,
					callback: function (result) {
						// result will be true if button was click, while it will be false if users close the dialog directly.
						if (result) {
							try {
								//delete data di server 
								var url = NA.common.addURLParam('Delete/', 'idapp', idapp);
								var NAAjax = NA.common.AJAX;
								NAAjax.POST(url,
									{ 'idapp': idapp },
									'application/json',
									'application/json',
									null, null,
									function () {
										var textStatus = JSON.parse(this.responseText);
										if (textStatus === 'success') {
											var rowNum = grid.getGridParam('rowNum'),
											allRecords = grid.getGridParam('records'),
											totalPages = parseInt((allRecords / rowNum) + 1),
											curPage = grid.getGridParam('page'),
											rowId = grid.jqGrid('getGridParam', 'selrow'),
											curRecount = grid.jqGrid('getGridParam', 'reccount');
											mustReload = true;
											if (parseInt(curRecount) === 1) {
												if (totalPages > 1) {
													curPage--;
												}
												else {
													mustReload = false;
													grid.delRowData(rowId);
												}
											}
											else if (parseInt(totalPages) === 1) {
												mustReload = false;
												grid.delRowData(rowId);
											}
											else if (parseInt(curRecount) > 1) {
												mustReload = false;
												grid.delRowData(rowId);
											}
											if (mustReload) {
												window.document.body.style.cursor = 'wait';
												grid.trigger("reloadGrid", [{ page: curPage }]);
											}
										}
									}, null,
									function () { throw new error(this.responseText + '\nStatus code :' + this.statusText); },
									function () { window.document.body.style.cursor = 'default'; },
									null);
								//$.post(url, {}, function (data, textStatus, jqXHR) {
								NA.NAEvent.stopPropagation(event);
								//});
							} catch (e) {
								console.log(e);
								window.document.body.style.cursor = 'default';
								if (JSON.parse(e.message)) {
									alert(e.name + ': ' + JSON.parse(e.message));
								}
								else {
									alert(e);
								}
							}
						}
						else {
							return false;
						}
					}
				});
			}
			else {
				document.body.style.cursor = 'default';
				alert('Please select data you want to delete');
			}
			return false;
		});

		//======================END GROUP ASSINGED HANDLER =========================================

		//======================GROUP DIALOG ENTRY==================================================
		window.showDialogEntry = function (event) {//function ini akan di panggil oleh NAJS.common.dialog,setiap menu add/edit/delete,etc di clik 
			//add handler to btnOK untuk mengantisipasi form load gagal
			var dialog = NA.common.dialog.doc.querySelector("div.containerDialog"),
        	   btnOKCancel = NA.NAEvent.doc.querySelectorAll('div.dialogButtonOKCancel>a.button'),
			   btnClose = NA.common.dialog.doc.querySelector('button.ui-button.ui-dialog-titlebar-close');
			//rubah dialog top nya jadi 10px saja
			dialog.style.top = "10px";
			
            $('div.dialogButtonOKCancel>a.button').on('click', function () {
                var frmEntry = NA.common.doc.querySelector('form#frm-NA-Entry-Goods_Receive');
                var emailForm = NA.common.doc.querySelector('form#email_data')
                if (frmEntry || emailForm) {
                    var inrtext = $(this).text()
                    ExecuteHandler(inrtext);
                    return false;
                }

                if (event) {
                    NA.NAEvent.stopPropagation(event);
                }
                return false;
            });
            $('button.ui-button.ui-dialog-titlebar-close').on('click', function (event) {
                NA.NAEvent.preventDefault(event);
                    ExecuteHandler('Close');
            });
			try {
				var target = NA.NAEvent.getTarget(event);
				if (target.innerText === ' Add' || target.innerText === ' Edit' || target.innerText === ' Open') {
					if (target.innerText.trim() !== 'Add') {
						var idapp = getGridCellValue(grid,'idapp');
						if (typeof idapp == 'undefined' || idapp === '') {
							alert('Please select data to edit');
							var dialog = dialog || NA.common.dialog.doc.querySelector("div.containerDialog");
							if (dialog) {
								NA.common.dialog.closeDialog(dialog);
							}
							if (document.body.style.cursor != 'default') { document.body.style.cursor = 'default'; }
							return false;
						}
					}
					$('div.maindialogContent').load("ShowEntry_Receive/?" + win.encodeURIComponent('idapp') + '=' + win.encodeURIComponent(idapp) +
                        '&' + win.encodeURIComponent('status') + '=' + win.encodeURIComponent(target.innerText.trim()), function (responseTxt, statusTxt, xhr) {//load /tampilkan form entry data                    

                        	if (statusTxt == "success") { //jika form sudah di load selanjutnya tinggal inisialisasi semua component dan simpang semua ke dalam variable jika perlua

                        		$(this).html(responseTxt);
                        		
                        		//======================BUTTONS Search================================================

                        		var btnFindGoods = NA.common.getElementID('FE_fk_goods'),
									btnFindSuplier = NA.common.getElementID('FE_fk_suplier'),
									btnFindPRBy = NA.common.getElementID('FE_fk_pr_by'),
									btnFindReceivedBy = NA.common.getElementID('FE_fk_receivedby'),
                        		//======================end BUTTONS Search================================================

                        		status = status || win.status || target.innerText.trim();
                        		switch (status) {
                        			case 'Add': {
                        				Array.prototype.forEach.call(NA.common.doc.querySelectorAll('div.dialogButtonEntry>a.button'), function (item) {
                        					if (item.hasAttribute('disabled')) {
                        						item.removeAttribute('disabled');
                        					}//remove attribute disable untuk button OK dan cancel bila statusnya Add
                        				});
                        				break;
                        			}
                        			//case 'Edit': {
                        			//	NA.common.getElementID('id_').disabled = true;
                        			//	break;
                        			//}
                        			case 'Open': {
                        				Array.prototype.forEach.call(NA.common.doc.querySelectorAll('div.dialogButtonEntry>a.button'), function (item) {
                        					if (!item.hasAttribute('disabled')) {
                        						item.setAttribute('disabled', true);
                        					}//remove attribute disable untuk button OK dan cancel bila statusnya Add
                        				});
                        				btnFindGoods.setAttribute('disabled', true);
                        				btnFindSuplier.setAttribute('disabled', true);
                        				btnFindPRBy.setAttribute('disabled', true);
                        				btnFindReceivedBy.setAttribute('disabled', true);

                                        //bind data to grid detail
                        				break;
                        			}
                        		};


                        		if (status !== 'Open' && status !== '') {//hanya untuk status Add/Edit
                        			//====================id_datereceived===========================
                        		    //set JQueryDatePicker
                        		    var btn_details = NA.common.getElementID('btn_add_Details');
                        		    NA.NAEvent.addHandler(btn_details, 'click', function () {
                        		        var total_receive = NA.common.getElementID('id_totalreceived').value;
                        		        var item_Code = NA.common.getElementID('id_fk_goods').value;
                        		        var goodsDesc = NA.common.getElementID('id_goods_desc').value;
                        		        var data = [];
                        		        for (var i = 1; i <= total_receive; i++) {
                        		            var obj = {}
                        		            obj['id'] = i;
                        		            obj['itemcode'] = item_Code;
                        		            obj['goodsDesc'] = goodsDesc;
                        		            obj['serialNum'] = 'N/A'
                        		            data.push(obj)
                        		        };
                        		        BootstrapDialog.show({
                        		            draggable: true,
                        		            type: BootstrapDialog.TYPE_SUCCESS,
                        		            size: BootstrapDialog.SIZE_SMALL,
                        		            message: function (dialogRef) {
                        		                var tblGrid = NA.common.doc.createElement('table');
                        		                tblGrid.id = 'Details_grid';
                        		                var detail_pager = NA.common.doc.createElement('div');
                        		                detail_pager.id = 'Details_pager';
                        		                var containerForm = NA.common.doc.createElement('div');
                        		                containerForm.className = 'containerForm';
                        		                containerForm.appendChild(tblGrid);
                        		                containerForm.appendChild(detail_pager);
                                                return containerForm
                        		            },
                        		            onshown: function (dialogRef) {
                        		                //loads Data into JqueryGrid
                        		                var gridTbl = $('#Details_grid');
                        		                var gridPager = $('#Details_pager');
                        		                gridTbl.jqGrid({
                        		                    data: data,
                        		                    editurl:'clientArray',
                        		                    datatype: "local",
                        		                    colNames: ['No', 'Item Code', 'Goods', 'Serial Number' ],
                        		                    colModel: [
                                                        { name: 'id', key: true,index:'id', align: 'left',width:50 },
                                                        { name: 'itemcode',index:'itemcode', width: 100, align: 'right', sortable: false, editable: false, },
                                                        { name: 'goodsDesc',index:'goodsDesc', width: 190, align: 'left', sortable: true, editable: false, },
                                                        { name: 'serialNum', index: 'serialNum', width: 250, sortable: true, editable: true, align: 'left', },
                        		                    ],
                        		                    gridComplete: function () {
                        		                        document.body.style.cursor = 'default';
                        		                    },
                        		                    cellEdit: false,
                        		                    viewrecords: true,
                        		                    height: '190px',
                        		                    rowNum: 20,
                        		                    rowList: [20, 50, 100, 200, 300, 500],
                        		                    sortname: "itemcode",
                        		                    sortorder: "asc",
                        		                    //multiSort: true,
                        		                    shrinkToFit: false,
                        		                    iconSet: "fontAwesome",
                        		                    //forceFit: true,
                        		                    //toolbar: true,
                        		                    scrollrows: true,
                                                    width:'inherit',
                        		                    pager: "#Details_pager",
                                                    onSelectRow:editRow
                        		                });
                        		                $('div#gbox_Details_grid, div#gview_Details_grid, div.ui-jqgrid-hdiv,div.ui-jqgrid-bdiv, div#Details_pager').css({
                                                    'width':'inherit'
                        		                });
                        		                gridTbl.navGrid(gridPager, {
                        		                    search: false, // show search button on the toolbar
                        		                    add: false,
                        		                    edit: false,
                        		                    del: false,
                        		                    refresh: false
                        		                });
                        		                var lastSelection;

                        		                function editRow(id) {
                        		                    if (id && id !== lastSelection) {
                        		                        gridTbl.jqGrid('restoreRow', lastSelection);
                        		                        gridTbl.jqGrid('editRow', id, { keys: true });
                        		                        lastSelection = id;
                        		                    }
                        		                }
                        		            },
                        		            animate: false,
                        		            closable: false,
                        		            closeByBackdrop: false,
                        		            closeByKeyboard: false,
                        		            buttons: [{
                        		                label: 'Cancel',
                        		                icon: 'glyphicon glyphicon-remove',
                        		                cssClass: 'btn-success',
                        		                action: function (dialogRef) {
                        		                    dialogRef.close();
                        		                },
                        		            }, {
                        		                label: 'OK',
                        		                id: 'btnOKFind_receivedby',
                        		                icon: 'glyphicon glyphicon-ok',
                        		                cssClass: 'btn-success',
                        		                action: function (dialogRef) {
                        		                    var dataRow = $('table#Details_grid').jqGrid('getRowData');
                        		                    var msgCont = NA.common.doc.querySelector('div.bootstrap-dialog-footer');
                        		                    for (i = 0; i < dataRow.length; i++) {
                        		                        //console.log(a[i]['serialNum']);
                        		                        if ($('table#Details_grid').jqGrid('getRowData')[i]['serialNum'] == 'N/A') {
                        		                            var msgP = NA.common.doc.createElement('p');
                        		                            NA.common.NA_setAttr(msgP, {
                        		                                'style': 'display: inline;float: left;position: relative;bottom: 25px;'
                        		                            });
                        		                            msgP.textContent = 'Please field all Serial Number'
                        		                            
                        		                            if ($('div.bootstrap-dialog-footer').has('p').length === 0) {
                        		                                msgCont.appendChild(msgP);
                        		                            }
                        		                        } else {
                        		                            var inputSerial = NA.common.getElementID('id_serialNum');
                        		                            inputSerial.value = inputSerial.value + ',' + dataRow[i]['serialNum'];
                        		                            
                        		                        }
                        		                    }
                        		                    dialogRef.close();
                        		                }
                        		            }]
                        		        });
                        		        restyleBoostrapDialog();
                        		    });
                        			    $('#id_datereceived').datepicker({
                        			        dateFormat: 'dd/mm/yy',
                        			        changeMonth: true,
                        			        changeYear: true,
                        			        dayNamesMin: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri ', 'Sat'],
                        			        //minDate:new Date(2018, 02, 25), //(function (s) {
                        			        //    if (s.trim() == 'Edit') {
                        			        //        //var elDateReceived = $('#id_datereceived').val();
                                            //        //var tgl = elDateReceived.match(/\d{2}/),
                                            //        //bln = elDateReceived.match(/\/\d{2}/).toString().replace('/'),
                                            //        //thn = elDateReceived.match(/\d{4}/);
                                            //        return new Date(2018, 02, 25)
                        			        //        //return $('#id_datereceived').val().getDate();
                        			        //    } else {
                                            //        return null
                        			        //    }
                        			        //})(window.status),
                        			        maxDate: 'today',
                        			    });
                        			    console.log($('#id_datereceived').val())
                        			    //setting Custom Validity
                        			    var elm = NA.common.doc.querySelector('#id_datereceived');
                        			    NA.NAEvent.addHandler(elm, 'input', function (event) {
                        			        var elpat = this.getAttribute('patern');
                        			        var patern = new RegExp(elpat, 'i');
                        			        var valuePat = this.value;
                        			        if (valuePat === null || valuePat === '') {
                        			            valuePat = this.textcontent;
                        			        }
                        			        if (!patern.test(valuePat)) {
                        			            this.setCustomValidity('Invalid date value');
                        			            this.validity.valid = false;
                        			        }
                        			        else {
                        			            this.setCustomValidity(''); //clearkan error custom validity
                        			        }
                        			    });
                        			    //=====================end id_datereceived==========================================


                        			function SearchEmployee(event) {
			                                BootstrapDialog.show({
			                                    draggable: true,
			                                    type: BootstrapDialog.TYPE_SUCCESS,
			                                    size: BootstrapDialog.SIZE_SMALL,
			                                    message: function (dialogRef) {
			                                        var placeHolder = 'Enter Employee who Received goods to search for';
			                                        var containerMessage = NA.common.dialog.createFormContainer('fk_receivedby', placeHolder,
			                                        function (e) {//event for blur
			                                            if (this.value === '') {
			                                                if (this.getAttribute('placeholder') === '') {
			                                                    this.setAttribute('placeholder', placeHolder);
			                                                }
			                                            }
			                                        },
			                                        function (e) {//event for focus
			                                            if (this.value === '') {
			                                                if (this.getAttribute('placeholder') === placeHolder) {
			                                                    this.setAttribute('placeholder', '');
			                                                }
			                                            }
			                                        },
			                                        function (e) {//even for keydown txtSearch
			                                            if (e.keyCode === 13) {
			                                                win.document.body.style.cursor = 'wait';
			                                                //cari data ke database
			                                                var url = 'SearchEmployeebyform/?' + win.encodeURIComponent('employee_name') + '=' + win.encodeURIComponent(e.target.value.trim());
			                                                if (gridTbl) {
			                                                    gridTbl.setGridParam({ url: url }).trigger("reloadGrid", [{ page: 1, }]);
			                                                }
			                                                win.document.body.style.cursor = 'default';
			                                            }
			                                        });
			                                        var children = containerMessage.childNodes;
			                                        var mainContainer = null, txtSearch = null;
			                                        for (var i = 0, len = children.length; i < len; i++) {
			                                            if (children[i].nodeType == 1 && children[i].className === 'maincontainerForm fk_receivedby') {
			                                                mainContainer = children[i]; break;
			                                            }
			                                        };

			                                        gridTbl = NA.common.doc.createElement('table');
			                                        gridTbl.id = 'jqGrid_NA_F_Goods_Receive_fk_employee';
			                                        gridPager = NA.common.doc.createElement('div');
			                                        gridPager.id = 'jqGrid_NA_F_Goods_Receive_fk_employee_Pager';
			                                        mainContainer.appendChild(gridTbl);
			                                        mainContainer.appendChild(gridPager)
			                                        return containerMessage;
			                                    },
			                                    onshown: function (dialogRef) {
			                                        var txtSearch = NA.common.getElementID('txtsearch_fk_receivedby');
			                                        //loads Data into JqueryGrid
			                                        var gridTbl = $('#jqGrid_NA_F_Goods_Receive_fk_employee');
			                                        var gridPager = $('#jqGrid_NA_F_Goods_Receive_fk_employee_Pager');
			                                        var urlPR = 'SearchEmployeebyform/?' + win.encodeURIComponent('employee_name') + '=' + win.encodeURIComponent(txtSearch.textContent.trim());
			                                        gridTbl.jqGrid({
			                                            url: urlPR,
			                                            mtype: "GET",
			                                            datatype: "json",//column IDapp, NO,	goods 	datereceived supliername FK_ReceivedBy 	receivedby FK_P_R_By pr_by totalpurchase totalreceived 
			                                            colNames: ['idapp', 'NO', 'NIK', 'Employee Name', ],
			                                            colModel: [
			                                                { name: 'idapp', key: true, hidden: true, align: 'left' },
			                                                { name: 'no', width: 40, align: 'right', sortable: false, editable: false, },
			                                                { name: 'nik', width: 90, align: 'left', sortable: true, editable: false, },
			                                                { name: 'employee_name', index: 'employee_name', width: 290, sortable: true, editable: false, align: 'left', },
			                                            ],
			                                            ondblClickRow: function (rowId) {
			                                                //fire button OK
			                                                var btnOK = dialogRef.getButton('btnOKFind_receivedby');
			                                                btnOK.click();
			                                            },
			                                            gridComplete: function () {
			                                                document.body.style.cursor = 'default';
			                                            },
			                                            cellEdit: false,
			                                            viewrecords: true,
			                                            height: '150px',
			                                            rowNum: 500,
			                                            rowList: [20, 50, 100, 200, 300, 500],
			                                            sortname: "employee_name",
			                                            sortorder: "asc",
			                                            multiSort: true,
			                                            //shrinkToFit: false,
			                                            iconSet: "fontAwesome",
			                                            //forceFit: true,
			                                            //toolbar: true,
			                                            scrollrows: true,
			                                            pager: "#jqGrid_NA_F_Goods_Receive_fk_employee_Pager"
			                                        });
			                                        gridTbl.navGrid(gridPager, {
			                                            search: false, // show search button on the toolbar
			                                            add: false,
			                                            edit: false,
			                                            del: false,
			                                            refresh: false
			                                        });
			                                    },
			                                    animate: false,
			                                    closable: false,
			                                    closeByBackdrop: false,
			                                    closeByKeyboard: false,
			                                    buttons: [{
			                                        label: 'Cancel',
			                                        icon: 'glyphicon glyphicon-remove',
			                                        cssClass: 'btn-success',
			                                        action: function (dialogRef) {
			                                            dialogRef.close();
			                                        },
			                                    }, {
			                                        label: 'OK',
			                                        id: 'btnOKFind_receivedby',
			                                        icon: 'glyphicon glyphicon-ok',
			                                        cssClass: 'btn-success',
			                                        action: function (dialogRef) {
			                                            //tempelkan data row di fk_goods, dan valuenya di goods_desc;
			                                            console.log(event);
			                                            var gridTbl = $('#jqGrid_NA_F_Goods_Receive_fk_employee');
			                                            var rowId = gridTbl.jqGrid('getGridParam', 'selrow');
			                                            var rowData = gridTbl.getRowData(rowId);
			                                            var employeeName = rowData['employee_name']
			                                            var nik_employee = rowData['nik']
			                                            if (event.target.id == 'FE_fk_pr_by') {
			                                                var fk_p_r_by = NA.common.getElementID('id_fk_p_r_by');
			                                                fk_p_r_by.value = nik_employee;
			                                                fk_p_r_by.dataset.value = rowId;
			                                                var employee_pr = NA.common.getElementID('id_employee_pr');
			                                                employee_pr.value = employeeName;
			                                            } else if (event.target.id == 'FE_fk_receivedby') {
			                                                var fk_recivied = NA.common.getElementID('id_fk_receivedby');
			                                                fk_recivied.value = nik_employee;
			                                                fk_recivied.dataset.value = rowId;
			                                                var fk_recivied_name = NA.common.getElementID('id_employee_received');
			                                                fk_recivied_name.value = employeeName;
			                                            }
			                                            dialogRef.close();
			                                        }
			                                    }]
			                                });
			                                //Atur tampilan                        			
			                                restyleBoostrapDialog();
			                                
			                            
                            		}
                        			//simpan original data di initializeForm
                        			var originalData = JSON.stringify(getValuesForm());
                        			//$('#id_initializeForm').val(originalData);
                        			initializeForm = NA.common.getElementID('id_initializeForm');
                        			initializeForm.Value = originalData;
                        			NA.NAEvent.addHandler(btnFindGoods, 'click', function (event) {
                                			BootstrapDialog.show({     					
                        			            draggable: true,
                        			            type: BootstrapDialog.TYPE_SUCCESS,
                        			            size: BootstrapDialog.SIZE_SMALL,
                        			            message: function (dialogRef) {

                        			                var placeHolder = 'Enter goods desc to search for';
                        			                containerMessage = NA.common.dialog.createFormContainer('fk_goods', placeHolder,
                                                    function (e) {//event for blur
                                                        if (this.value === '') {
                                                            if (this.getAttribute('placeholder') === '') {
                                                                this.setAttribute('placeholder', placeHolder);
                                                            }
                                                        }
                                                    },
                                                    function (e) {//event for focus
                                                        if (this.value === '') {
                                                            if (this.getAttribute('placeholder') === placeHolder) {
                                                                this.setAttribute('placeholder', '');
                                                            }
                                                        }
                                                    },
                                                    function (e) {//even for keydown txtSearch													
                                                        if (e.keyCode === 13) {
                                                            NA.NAEvent.preventDefault(e);
                                                            win.document.body.style.cursor = 'wait';
                                                            //cari data ke database
                                                            var url = 'SearchGoodsbyForm/?' + win.encodeURIComponent('goods_desc') + '=' + win.encodeURIComponent(e.target.value.trim());
                                                            if (gridTbl) {
                                                                jQuery(gridTbl).setGridParam({ url: url }).trigger("reloadGrid", [{ page: 1, }]);
                                                            }
                                                            win.document.body.style.cursor = 'default';
                                                            NA.NAEvent.stopPropagation(e);
                                                        }
                                                    }, function (e) {
                                                        txtSearch = NA.common.getElementID('txtsearch_fk_goods');
                                                        NA.common.triggerKeyboardEvent(txtSearch, 13);
                                                    });
                        			                var children = containerMessage.childNodes;
                        			                var mainContainer = null, txtSearch = null;
                        			                for (var i = 0, len = children.length; i < len; i++) {
                        			                    if (children[i].nodeType == 1 && children[i].className === 'maincontainerForm fk_goods') {
                        			                        mainContainer = children[i]; break;
                        			                    }
                        			                };

                        			                //loads Data into JqueryGrid
                        			                gridTbl = NA.common.doc.createElement('table');
                        			                gridTbl.id = 'jqGrid_NA_F_Goods_Receive_FK_Goods';
                        			                gridPager = NA.common.doc.createElement('div');
                        			                gridPager.id = 'jqGrid_NA_F_Goods_Receive_FK_Goods_Pager';
                        			                mainContainer.appendChild(gridTbl);
                        			                mainContainer.appendChild(gridPager);
                        			                return containerMessage;
                        			            },
                        			            onshown: function (dialogRef) {
                        			                txtSearch = NA.common.getElementID('txtsearch_fk_goods');
                        			                var valSearch = '';
                        			                if (txtSearch != null) {
                        			                    valSearch = win.encodeURIComponent(txtSearch.textContent.trim());
                        			                }
                        			                gridTbl = $('#jqGrid_NA_F_Goods_Receive_FK_Goods');
                        			                var urlFKGoods = 'SearchGoodsbyForm/?' + win.encodeURIComponent('goods_desc') + '=' + valSearch;
                        			                gridTbl.jqGrid({
                        			                    url: urlFKGoods,
                        			                    mtype: "GET",
                        			                    datatype: "json",//column IDapp, NO,	goods 	datereceived supliername FK_ReceivedBy 	receivedby FK_P_R_By pr_by totalpurchase totalreceived 
                        			                    colNames: ['idapp', 'NO', 'itemcode', 'goods Description', ],
                        			                    colModel: [
                                                            { name: 'idapp', key: true, hidden: true, align: 'left' },
                                                            { name: 'no', width: 40, align: 'right', sortable: false, editable: false, },
                                                            { name: 'itemcode', width: 80, align: 'left', sortable: true, editable: false, },
                                                            { name: 'goods', index: 'goods', width: 290, sortable: true, editable: false, align: 'left', },
                        			                    ],
                        			                    ondblClickRow: function (rowId) {
                        			                        //fire button OK
                        			                        var btnOK = dialogRef.getButton('btnOKFindGoods');
                        			                        btnOK.click();
                        			                    },
                        			                    gridComplete: function () {
                        			                        document.body.style.cursor = 'default';
                        			                    },
                        			                    loadError: function (xhr, textStatus, errorThrown) {
                        			                        var error_msg = xhr.responseText
                        			                        var msg = "Some errors occurred during processing:"
                        			                        msg += '\n\n' + error_msg
                        			                        alert(msg)
                        			                    },
                        			                    cellEdit: false,
                        			                    viewrecords: true,
                        			                    height: '150px',
                        			                    rowNum: 500,
                        			                    rowList: [20, 50, 100, 200, 300, 500],
                        			                    sortname: "itemcode",
                        			                    sortorder: "asc",
                        			                    multiSort: true,
                        			                    //shrinkToFit: false,
                        			                    iconSet: "fontAwesome",
                        			                    //forceFit: true,
                        			                    //toolbar: true,
                        			                    scrollrows: true,
                        			                    //hidegrid: true,
                        			                    //caption: "Transactions ---Find goods",
                        			                    pager: "#jqGrid_NA_F_Goods_Receive_FK_Goods_Pager"
                        			                });
                        			                gridTbl.navGrid('#jqGrid_NA_F_Goods_Receive_FK_Goods_Pager', {
                        			                    search: false, // show search button on the toolbar
                        			                    add: false,
                        			                    edit: false,
                        			                    del: false,
                        			                    refresh: false
                        			                });
                        			                restyleBoostrapDialog();

                        			            },
                        			            closable: false,
                        			            animate: false,
                        			            closeByBackdrop: false,
                        			            closeByKeyboard: false,
                        			            buttons: [{
                        			                label: 'Cancel',
                        			                icon: 'glyphicon glyphicon-remove',
                        			                cssClass: 'btn-success',
                        			                action: function (dialogRef) {
                        			                    dialogRef.close();
                        			                },
                        			            }, {
                        			                label: 'OK',
                        			                id: 'btnOKFindGoods',
                        			                icon: 'glyphicon glyphicon-ok',
                        			                cssClass: 'btn-success',
                        			                action: function (dialogRef) {
                        			                    var idapp = getGridCellValue(gridTbl, 'idapp');
                        			                    if (idapp) {//cell di select sama user
                        			                        var rowId = gridTbl.jqGrid('getGridParam', 'selrow');
                        			                        var rowData = gridTbl.getRowData(rowId);
                        			                        var itemCode = rowData['itemcode'], goods_Desc = rowData['goods'];
                        			                        var txtid_fk_goods = NA.common.getElementID('id_fk_goods');
                        			                        txtid_fk_goods.value = itemCode;
                        			                        txtid_fk_goods.dataset.value = rowId;
                        			                        var txtgoodsDesc = NA.common.getElementID('id_goods_desc');
                        			                        txtgoodsDesc.value = goods_Desc;
                        			                        dialogRef.close();
                        			                    }
                        			                }
                        			            }]
                        			        });
                            			});
									NA.NAEvent.addHandler(btnFindSuplier, 'click', function (event) {
			                               BootstrapDialog.show({
                        			            draggable: true,
                        			            type: BootstrapDialog.TYPE_SUCCESS,
                        			            size: BootstrapDialog.SIZE_SMALL,
                        			            message: function (dialogRef) {
                        			                var placeHolder = 'Enter Suplier name to search for';
                        			                var containerMessage = NA.common.dialog.createFormContainer('fk_suplier', placeHolder,
                                                    function (e) {//event for blur
                                                        if (this.value === '') {
                                                            if (this.getAttribute('placeholder') === '') {
                                                                this.setAttribute('placeholder', placeHolder);
                                                            }
                                                        }
                                                    },
                                                    function (e) {//event for focus
                                                        if (this.value === '') {
                                                            if (this.getAttribute('placeholder') === placeHolder) {
                                                                this.setAttribute('placeholder', '');
                                                            }
                                                        }
                                                    },
                                                    function (e) {//even for keydown txtSearch
                                                        if (e.keyCode === 13) {
                                                            win.document.body.style.cursor = 'wait';
                                                            //cari data ke database
                                                            var url = 'SearchSuplierbyForm/?' + win.encodeURIComponent('supliername') + '=' + win.encodeURIComponent(e.target.value.trim());

                                                            if (gridTbl) {
                                                                gridTbl.setGridParam({ url: url }).trigger("reloadGrid", [{ page: 1, }]);
                                                            }
                                                            win.document.body.style.cursor = 'default';
                                                        }
                                                    });
                        			                var children = containerMessage.childNodes;
                        			                var mainContainer = null, txtSearch = null;
                        			                for (var i = 0, len = children.length; i < len; i++) {
                        			                    if (children[i].nodeType == 1 && children[i].className === 'maincontainerForm fk_suplier') {
                        			                        mainContainer = children[i]; break;
                        			                    }
                        			                };
                        			                //loads Data into JqueryGrid
                        			                gridTbl = NA.common.doc.createElement('table');
                        			                gridTbl.id = 'jqGrid_NA_F_Goods_Receive_fk_suplier';
                        			                gridPager = NA.common.doc.createElement('div');
                        			                gridPager.id = 'jqGrid_NA_F_Goods_Receive_fk_suplier_Pager';
                        			                mainContainer.appendChild(gridTbl);
                        			                mainContainer.appendChild(gridPager);
                        			                return containerMessage;
                        			            },
                        			            onshown: function (dialogRef) {
                        			                txtSearch = NA.common.getElementID('txtsearch_fk_suplier');
                        			                //loads Data into JqueryGrid 
                        			                gridTbl = $('#jqGrid_NA_F_Goods_Receive_fk_suplier');
                        			                gridPager = $('#jqGrid_NA_F_Goods_Receive_fk_suplier_Pager');
                        			                var urlFKSuplier = 'SearchSuplierbyForm/?' + win.encodeURIComponent('supliername') + '=' + win.encodeURIComponent(txtSearch.textContent.trim());
                        			                gridTbl.jqGrid({
                        			                    url: urlFKSuplier,
                        			                    mtype: "GET",
                        			                    datatype: "json",//column idapp, no,supliercode,supliername
                        			                    colNames: ['NO', 'suplier code', 'suplier name', ],
                        			                    colModel: [
                                                            { name: 'no', width: 40, align: 'right', sortable: false, editable: false, },
                                                            { name: 'supliercode', width: 90, align: 'left', sortable: true, editable: false, },
                                                            { name: 'supliername', index: 'supliername', width: 290, sortable: true, editable: false, align: 'left', },
                        			                    ],
                        			                    ondblClickRow: function (rowId) {
                        			                        //fire button OK
                        			                        var btnOK = dialogRef.getButton('btnOKFindsuplier');
                        			                        btnOK.click();
                        			                    },
                        			                    gridComplete: function () {
                        			                        document.body.style.cursor = 'default';
                        			                    },
                        			                    loadError: function (xhr, textStatus, errorThrown) {
                        			                        var error_msg = xhr.responseText
                        			                        var msg = "Some errors occurred during processing:"
                        			                        msg += '\n\n' + error_msg
                        			                        alert(msg)
                        			                    },
                        			                    cellEdit: false,
                        			                    viewrecords: true,
                        			                    height: '150px',
                        			                    rowNum: 500,
                        			                    rowList: [20, 50, 100, 200, 300, 500],
                        			                    sortname: "supliername",
                        			                    sortorder: "asc",
                        			                    multiSort: true,
                        			                    //shrinkToFit: false,
                        			                    iconSet: "fontAwesome",
                        			                    //forceFit: true,
                        			                    //toolbar: true,
                        			                    scrollrows: true,
                        			                    //hidegrid: true,
                        			                    pager: "#jqGrid_NA_F_Goods_Receive_fk_suplier_Pager"
                        			                });
                        			                gridTbl.navGrid(gridPager, {
                        			                    search: false, // show search button on the toolbar
                        			                    add: false,
                        			                    edit: false,
                        			                    del: false,
                        			                    refresh: false
                        			                });
                        			            },
                        			            closable: false,
                        			            animate: false,
                        			            closeByBackdrop: false,
                        			            closeByKeyboard: false,
                        			            buttons: [{
                        			                label: 'Cancel',
                        			                icon: 'glyphicon glyphicon-remove',
                        			                cssClass: 'btn-success',
                        			                action: function (dialogRef) {
                        			                    dialogRef.close();
                        			                },
                        			            }, {
                        			                label: 'OK',
                        			                id: 'btnOKFindsuplier',
                        			                icon: 'glyphicon glyphicon-ok',
                        			                cssClass: 'btn-success',
                        			                action: function (dialogRef) {
                        			                    var supliercode = getGridCellValue(gridTbl, 'supliercode');
                        			                    if (supliercode) {//cell di select sama user
                        			                        //tempelkan data row di fk_goods, dan valuenya di goods_desc;
                        			                        var rowId = gridTbl.jqGrid('getGridParam', 'selrow');
                        			                        var rowData = gridTbl.getRowData(rowId);
                        			                        var supliername = rowData['supliername'];
                        			                        var txtid_fk_suplier = NA.common.getElementID('id_fk_suplier');
                        			                        txtid_fk_suplier.value = supliercode;
                        			                        var txtsupliername = NA.common.getElementID('id_supliername');
                        			                        txtsupliername.value = supliername;
                        			                    }
                        			                    dialogRef.close();
                        			                }
                        			            }]
                        			        });
                        			        //Atur tampilan                        			
                        			        restyleBoostrapDialog();
                            			});
									NA.NAEvent.addHandler(btnFindPRBy,'click',function(event){
										SearchEmployee(event);
									});
									NA.NAEvent.addHandler(btnFindReceivedBy,'click',function(event){
										SearchEmployee(event);
									});
                        		}//hanya untuk status Add/Edit                  	    
                        	}
                        	NA.NAEvent.preventDefault(event);
                        	if (document.body.style.cursor != 'default') { document.body.style.cursor = 'default'; }
                        });
				}
				//else if(target.innerText === ' Employee'){
				//    alert('employee load');
				//    return false;
				//}                
			} catch (e) {
				dialog = NA.common.dialog.doc.querySelector("div.containerDialog");
				if (dialog) {
					NA.common.dialog.closeDialog(dialog);
				}
				if (document.body.style.cursor != 'default') { document.body.style.cursor = 'default'; }
				alert(e);
			}
		};
	})();
</script>
{% endblock %}